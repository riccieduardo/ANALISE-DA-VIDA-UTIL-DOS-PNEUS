SELECT OS.NUMERO
	,OS.DATA
	,OS.KM
	,V.PLACA
	,MV.CODIGO_FIPE
	,MV.DESCRICAO AS MODELO_FIPE
	,C.NUMERO AS CLIENTE_NUMERO
	,C.NOME AS CLIENTE_NOME
	,IOS.DESCRICAO AS ITEM
	,IOS.QTDE
	,IOS.VALOR_UNITARIO
	,IOS.QTDE * IOS.VALOR_UNITARIO AS VALOR_TOTAL
FROM ORDEM_SERVICO OS
JOIN ITEM_ORDEM_SERVICO IOS ON OS.CODIGO = IOS.ORDEM_SERVICO
JOIN VEICULO V ON OS.VEICULO = V.CODIGO
JOIN CLIENTE C ON OS.CLIENTE = C.CODIGO
JOIN PLANO_CONTA PC ON IOS.PLANO_CONTA = PC.CODIGO
JOIN MODELO_VEICULO MV ON V.MODELO_VEICULO = MV.CODIGO
JOIN (
	--VEICULOS COM TROCA DE PNEUS EM 2015
	SELECT DISTINCT V.CODIGO
	FROM ORDEM_SERVICO OS
	JOIN ITEM_ORDEM_SERVICO IOS ON IOS.ORDEM_SERVICO = OS.CODIGO
	JOIN VEICULO V ON OS.VEICULO = V.CODIGO
	WHERE CAST(OS.DATA AS DATE) >= '01/01/2015'
		AND CAST(OS.DATA AS DATE) <= '12/31/2015'
		AND IOS.DESCRICAO LIKE '%PNEU%'
		AND IOS.SITUACAO <> 'N'
		AND OS.SITUACAO <> 'N'
	) OS_2015 ON OS_2015.CODIGO = V.CODIGO
WHERE IOS.DESCRICAO LIKE '%PNEU%'
	AND IOS.SITUACAO <> 'N'
	AND OS.SITUACAO <> 'N'
	AND PC.DESCRICAO IN (
		'Pneus e Servicos'
		,'Manutencao Preventiva'
		,'Manutencao Corretiva'
		)
ORDER BY V.PLACA
	,OS.KM
	,OS.DATA;
